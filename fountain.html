<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="css/style.css">
</head>
<body>
	
	<script src="/js/snap.svg-min.js"></script>
	<script src="/js/snaptut-freetransform.js"></script>
	<script>
		var mainSc = Snap(window.innerWidth, window.innerHeight);
		window.addEventListener('resize', (function(e) {
	          return mainSc.attr({
	            width: window.innerWidth,
	            height: window.innerHeight
	          });
	    }));
	    var iconRepo = {};
	    Snap.load('svg/icons_new.svg', function(f){
			// iconRepo.inBefore = f.select('#icon_insertbefore');
			// iconRepo.inAfter = f.select('#icon_insertafter');
			iconRepo.copy = f.select('#icon_copy');
			iconRepo.scale = f.select('#icon_scale');
			//iconRepo.palette = f.select('#icon_palette');
			iconRepo.flip = f.select('#icon_flip');
			iconRepo.delete = f.select('#icon_delete');
			iconRepo.jremove = f.select('#icon_jremove');
			//iconRepo.back = f.select('#icon_back');
		});

		var objOrd = [];
		var ballRepo = [];
		var itemBall = 0;
		var bG = 0;
		var gr = mainSc.gradient("r(0.3, 0.5, 0.5)#fff-#ff6375-#e30d11-#c4140e");

		mainSc.click(function(e){
			if(e.target.tagName == 'svg'){
				var path = 
					mainSc.path('M '+e.offsetX+','+e.offsetY+' '
						+'T '+(e.offsetX)+','+(e.offsetY+70)+' '
						+' T '+(window.innerWidth/2)+','+(window.innerHeight-80)
						+' L '+(window.innerWidth/2)+','+(window.innerHeight)
						)
						.attr({fill: "transparent", stroke: "#ccc", strokeWidth: 2});
				if(itemBall==0){
					bG = mainSc.g().drag();
					bG.click(function(e){
						new Joystick(mainSc, e, this, iconRepo).init();
					});
					var osn = mainSc.circle(window.innerWidth/2, window.innerHeight,20).attr({fill:'#ff0'}).addClass('osnova');
					ballRepo.push(osn);
				}
				ballRepo.push(path.addClass('nitka'));
				ballRepo.push(mainSc.ellipse(e.offsetX,e.offsetY,50,70)
									.attr({fill:gr, id:'circle'}).addClass('ball')
									.drag(
											function(dx, dy, x, y, e){
												this.attr({cx: x, cy: y});
												path.attr('d',
													'M '+e.offsetX+','+e.offsetY+' '
													+'T '+(e.offsetX)+','+(e.offsetY+70)+' '
													+' T '+(window.innerWidth/2)+','+(window.innerHeight-80)
													+' L '+(window.innerWidth/2)+','+(window.innerHeight)
													);
											}
										)
							);
				itemBall++;
				
			}
		});

		 var circle55 = mainSc.circle(120,120,50).attr({fill:"#f00",stroke:"#000",strokeWidth:3, id:'circle'}).drag();
		 circle55.click(function(){
		 	ballRepo.forEach(
		 		function(item,i,arr){
		 			if(item.hasClass('ball')) bG.add(item.undrag());
		 			else bG.add(item);
		 		});
			ballRepo = [];
			itemBall = 0;
		 });

		// objOrd.push(circle);
		// circle.click(function(){
		// 	moveZ(this, 'before');
		// });
		// var circle2 = mainSc.circle(150,120,60).attr({fill:"#222",stroke:"#000",strokeWidth:3, id:'circle2'}).drag();
		// objOrd.push(circle2);
		// circle2.click(function(){
		// 	moveZ(this, 'before');
		// });
		// var rect = mainSc.rect(120,120,60,50).attr({fill:"#f00",stroke:"#000",strokeWidth:3, id:'rect'}).drag();
		// objOrd.push(rect);
		// rect.click(function(){
		// 	moveZ(this, 'before');
		// });
		// var rect2 = mainSc.rect(140,150,80,100).attr({fill:"#f55",stroke:"#000",strokeWidth:3, id:'rect2'}).drag();
		// objOrd.push(rect2);
		// rect2.click(function(){
		// 	moveZ(this, 'before');
		// });
		// circle.click(function(){
		// 	this.before(rect);
		// });
		// rect.click(function(){
		// 	this.before(circle);
		// });

		function moveZ(obj, dir){
			var lOr = objOrd.length;
			
			if( lOr>1){
				for(var i = 0;i<lOr;i++){
					if(obj == objOrd[i]){
						if((i==0 && dir == 'after') || (i==lOr-1 && dir == 'before')){
							return;
						}else{
							var tmpI = (dir == 'after') ? i-1 : i+1;
							var tmp = objOrd[tmpI];
							if(dir == 'after')
								obj.after(tmp);
							else
								obj.before(tmp);
							objOrd[tmpI]=obj;
							objOrd[i]=tmp;
						}
						return;
					}
				}
			}
		}

		function degToRad (deg) { return deg / 180 * Math.PI; }

		
	</script>
	<script src="js/JSTk.js"></script>
</body>
</html>